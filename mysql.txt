一.MYSQL概述和部署


1.数据库分类
a.关系型数据库：，oracle,mysql
b.非关系型数据库：强调键值，则性能跟高，如Redius，MongoDB

2.运维的指责：
备份恢复，
主备复制（使主服务器和备用服务器保持一样，减少服务器压力）
读写分离
HA架构
分布式数据库--重要，涉及集群
压力测试
性能优化
自动化运维

3.SQL语句的分类：
A.DDL 数据库定义语句：数据库，表，视图，索引存储过程，函数的创建等   //主要开发人员关注
B.DML：数据库操纵语言：插入数据，删除，更新，查询数据库（增删改）              //开发人员涉及 
C.DQL:数据库查询语言：select查询数据。
D.DCL：数据库控制语句：例如控制用户的访问权限，GRANT,REVOKE

注意：有时候我们常把B和C归结为一种语句。

4.安装（community server版本）
二进制rmp   YUM REPOSITORY （下载仓库）
 A.安装仓库  a.wget+下载连接 b.yum -y mysql(安装仓库) c.yum makecahe(更新仓库) d.yum repolist(查询是否仓库安装好)
 B。安装mysql   yum list |grep mysql-community （找server）  然后安装  yum -y install mysql-community-server.x86_64
预编译
	需要添加用户组，一些路径也未指定，需要初始化
源码安装

5.基本配置(第二集)（进入mysql后，命令以;结束）
第一次启动：初始化会生成 文件路径：/var/lib/mysql
启动Mysql:systemctl start mysql--->生成上边的文件
设置防火墙：
	sed -ri '/SELINUX=/cSELINUX=disabled' /etc/selinux/config
	systemctl stop firewalld
	systemctl disable firewalld
测试mysql是否安装正确
	mysql -uroot -p‘密码’(p后无空格 用户名+密码)
	查询密码：grep 'password' /var/log/mysqld.log（临时密码）
	设置密码：alter user root@'localhost' identified by '密码'
	命令;结束，然后 \q  退出，返回到终端
	再次登陆：mysql -uroot -p'密码'
	查看数据库：show databases
	查看版本：select version()
	
6.密码忘记
 a.初始化，风险很高，会清除很多数据。
 b.vim /etc/my.cnf 文本末尾加上skip-grant-tables （使用无密码进去数据库）---重启mysql service mysql restart----设置密码（模糊）----删除或者注释/etc/my.cnf中的最后一行（第五集）
 
二.MYSQL数据库操作

	不同业务创建不同的数据库(mysql 命令大小写不敏感)
	创建：CREATE DATABASE 数据库名;
	进入数据库：USE 库名
	查看数据库：SHOW DATABASES;
	选择数据库：SELECT database();
				USE 数据库名;
	删除数据库： DROP DATABASE 数据库名;

三.表操作
	查看当前库中的表：show tables
	创建表：create table
	查看表结构：desc table & show create table 表名 & DECRIBE 表名
	修改表 alter table
	复制表 create table
	删除表 drop table
	表中插入数据：insert into list_name values(...,..)
1.根据数据的类型，创建不同的相应的表（库中可以有很多表）（运维也会偶尔用到）
	分类：数值，字符串，时间和日期型（三种类型中又分为多类型，如数值，包括整数，浮点等）根据字段（列）设置数据属性，如性别，数据类型是字符串，但是用户只能选择man or woman ，这些都是设置的，存储年龄的字段必须是数值
	查看库中是否有表：show tables
	创建表：create table 表名（tint_test tinyint int_test,int）(括号中可以设置多种字段，每种字段：字段名+数据类型)
	查看表的信息：desc 表名 （包含字段名称和数据类型）（select是查询表中的内容）
	插入值到表中，检测是否能够操作 insert into 表名 values（111，111）(value中参数 除了字符串需要引号，其他不要)
	查询表中的字段：select * from 表名（查看所有字段）
	对特定的字段插入数据的格式：insert into 表名（tint_test）values(128) 格式是这样，但是128是超出范围了，插入失败
	浮点数：
		因为浮点数可能存在很多小数点，可以设置宽度，仅仅是显示，不是限制（不要深究）
	总结：插入列表，需要根据设定的表的属性存储，比如，超过数值类型的范围或者不是该数值类型 都会失败 插入时，数据类型跟括号，数值表示宽度，字符串表示限制如 enum(‘man’,'woman')只有能二选一
2.时间和日期
	数据类型：date,time,datetime，timestamp(时间戳)
	select now();返回当前系统的时间，插入时间时，给定参数时null时，默认当前时间
	插入年 最好4位数 插入两位年份时：<=69，显示结果以20开头，如65-->2065; >=70时候，显示结果以19开头，如82-->1982
3.字符串 char和varchar,enum单选（枚举）（如性别），set（集合）多选
	varchar的值的长度可变，没限制，更好用，内容固定用char,不固定用varchar
	字符串插入注意用引号，包括字段名和数据
	char插入字符串时末尾会删除空格，varchar末尾不会删除，可以通过字符串长度查看效果（select length(字段名) from 表名）或者用字符串拼接检验：select concat(字段名，‘=’) from 表名（等号只是举例）
4.限制条件（约束条件）
5.
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	

8.cluster  集群版本的mysql（新建yum源，创建yum源）
 下载适合cluster mysql 
 地址：www.galeracluster.com(携带补丁的mysql)
	安装 yum -y install mysql-wsrep-5.7.x86_64（多台服务器都装相同的mysql）
	创建用于数据同步的用户(多窗口同时执行相同的命令  xshell中的工具第一项)（所有服务器）
		grant all on *.* to 'sst'@''
 配置集群：（14-3集）（服务器的复制）
	vim /etc/my.cnf 追加：
		#可选参数
		server_id=1                          要改
		binlog_format=row
		default_storage-engine=InnoDB
		innodb_file_per_tabler=1
		innodb_autonic_lock_mode=2
		#重要集群参数
		wsrep_on=ON
		wsrep_provider=/usr/lib64/galerra/...
		wsrep_cluster_name=''
		wsrep_cluster_address='gcomm://'（改，引荐人，第二个可以写上第一个及其他，如‘gcomm://galera1,glerra3’）通讯地址
		wsrep_node_name=''             改
		wsrep_node_address='ip地址'	      改
		wsrep_sst_auth=sst:密码
		wsrep_sst_method=rsync
	保存退出，重启服务器：systemctl restart mysqld 查看是否能否正常启动 ，退到控制台，查看是否wsrep等变量状态，show status like 'wsrep%'，确认状态Ok后，表示在集群中加入了一个节点
	将其他服务器节点加入到这个集群，拷贝上面配置文件过去即可（需要更改的参数在上面有备注）,都重启，查看状态
	在服务器1上创建数据库和表，并查看其他服务器有同步的内容
	当其中一个节点，即一个服务器重启 是否能自动加入集群，注意：非创建集群的服务器重启时，会自动加入集群，但是若是创建集群的服务器重启后不会加入原来的集群，而是新建一个集群，这时我们需要更改集群配置文件的通讯地址，再次重启就ok
	此时，集群就搭建好了
	但是，此时客户端访问时，该用哪个服务器呢？该怎么用呢？
		需要放置一个中间件（中间件的种类有mycat等）
		中间件mycat是java开发的，安装jdk
		在官网下载mycat中间件 关闭防火墙
		配置中间件：(两个文件sever和schema)
			授权：grant all on.....(网上查询授权命令)（14-4）
			打开文件：可以设定读操作时，自动连接什么服务器，或者写操作连接哪些服务器
					  vi /usr/local/mycat/conf/server.xml(mycat的安装路径)，可以更改用户名 user name ,记住更改后 需要注释以前的用户信息或者删除
					  vi /usr/local/mycat/conf/schema.xml 可以更改dataNode的参数，且更改连接的主机地址和数据库，后定义...
					  
	启动mycat	
	
	
